var leavingOnGetTime=0,returningFromGetTime=0,selected=0;function aaBookingModuleFormatDate(paramMonth,paramDay){var d,nowTime=new Date(),now=new Date(nowTime.getFullYear(),nowTime.getMonth(),nowTime.getDate());if(paramMonth==="-1000"||paramDay==="-1000"){d=null;}else{var checkDate=new Date(now.getFullYear(),parseInt(paramMonth)-1,paramDay);try{d=new Date(((checkDate<now)?now.getFullYear()+1:now.getFullYear()),parseInt(paramMonth)-1,paramDay);}catch(e){d=null;}}return d;}function dateCompareTo(date1,date2){if(!date1){date1=new Date(0);}if(!date2){date2=new Date(0);}return((date1.getTime()<date2.getTime())?-1:((date1.getTime()>date2.getTime())?1:0));}function populateLeavingOnGetTime(){try{leavingOnGetTime=jQuery("#aa-leavingOn").aaDateInput("getDate").getTime();}catch(e){leavingOnGetTime=0;}}function populateReturningFromGetTime(){try{returningFromGetTime=jQuery("#aa-returningFrom").aaDateInput("getDate").getTime();}catch(e){returningFromGetTime=0;}}function checkLeavingOn(){if(jQuery("#aa-returningFrom").aaDateInput("getDate")!==null&&(dateCompareTo(jQuery("#aa-leavingOn").aaDateInput("getDate"),jQuery("#aa-returningFrom").aaDateInput("getDate"))>0)){jQuery("#aa-returningFrom").datepicker("setDate",null);jQuery("#aa-returningFrom").blur();synchReturningFromDropdowns();}}function synchLeavingOnDropdowns(){date=jQuery("#aa-leavingOn").aaDateInput("getDate");jQuery("#reservationFlightSearchForm\\.flightParams\\.flightDateParams\\.travelMonth").val((date===null)?"-1000":date.getMonth()+1);jQuery("#reservationFlightSearchForm\\.flightParams\\.flightDateParams\\.travelDay").val((date===null)?"-1000":date.getDate());}function checkReturningFrom(){if(jQuery("#aa-returningFrom").aaDateInput("getDate")!==null&&(dateCompareTo(jQuery("#aa-leavingOn").aaDateInput("getDate"),jQuery("#aa-returningFrom").aaDateInput("getDate"))>0)){jQuery("#aa-leavingOn").datepicker("setDate",null);jQuery("#aa-leavingOn").blur();synchLeavingOnDropdowns();}}function synchReturningFromDropdowns(){date=jQuery("#aa-returningFrom").aaDateInput("getDate");jQuery("#reservationFlightSearchForm\\.returnDate\\.travelMonth").val((date===null)?"-1000":date.getMonth()+1);jQuery("#reservationFlightSearchForm\\.returnDate\\.travelDay").val((date===null)?"-1000":date.getDate());}jQuery(document).ready(function(){jQuery(".aaMultiCityLink").click(function(e){jQuery(".enableMultiCity").attr("disabled","");});jQuery(".aaHomePageSubmit").click(function(e){var retVal=true;try{jQuery(".flightSearch").val(((jQuery("#flightSearchForm\\.tripType\\.redeemMiles")[0].checked)?"award":"revenue"));}catch(ex){}var fromDate=jQuery("#aa-leavingOn")[0].dateInput.getDate();var toDate=jQuery("#aa-returningFrom")[0].dateInput.getDate();jQuery(".aaSC_Control_BookTravel_RoundTripHotel:checked:first").each(function(){var localeParam="?ADID=AACM-DEP-ALL-09-01";if(dynUserLocale=="en_CA"){localeParam="?ADID=AACA-DEP-ALL-14-31";}else{if(dynUserLocale=="es_MX"){localeParam="?ADID=AAMX-DEP-ALL-14-31";}}var fmDate="";if(fromDate!==null){if(dynUserLocale=="es_MX"){fmDate=fromDate.getDate()+"/"+(fromDate.getMonth()+1)+"/"+fromDate.getFullYear();}else{fmDate=(fromDate.getMonth()+1)+"/"+fromDate.getDate()+"/"+fromDate.getFullYear();}}var tDate="";if(toDate!==null){if(dynUserLocale=="es_MX"){tDate=toDate.getDate()+"/"+(toDate.getMonth()+1)+"/"+toDate.getFullYear();}else{tDate=(toDate.getMonth()+1)+"/"+toDate.getDate()+"/"+toDate.getFullYear();}}var flightHotelURL=dynAavDeepLinkURL+localeParam+"&searchType=matrix&adults="+jQuery("#flightSearchForm\\.adultPassengerCount\\.flightHotel").val()+"&rooms=1&serviceclass="+jQuery("#fhServiceClass").val()+"&from_date="+fmDate+"&to_date="+tDate+"&from_city_code="+jQuery("#reservationFlightSearchForm\\.originAirport").val()+"&to_city_code="+jQuery("#reservationFlightSearchForm\\.destinationAirport").val()+"&to_time=0&from_time=0";captureExtLink(dynAavDeepLinkURL+localeParam,document.location);e.preventDefault();window.open(flightHotelURL,"aavacations");});if(retVal){jQuery("#reservationFlightSearchForm").each(function(){trackAllFormValues(this);});}return retVal;});jQuery(".aaMoreDetails").click(function(e){e.preventDefault();jQuery("#reservationFlightSearchForm").each(function(){var resForm=this;jQuery(".aaSC_Control_BookTravel_RoundTrip:checked:first").each(function(){jQuery("#moreOptionsIndicator").val(dynMoreOptionsRoundTrip);});jQuery(".aaSC_Control_BookTravel_OneWay:checked:first").each(function(){jQuery("#moreOptionsIndicator").val(dynMoreOptionsOneWay);});jQuery(".aaHomePageSubmit").click();});});jQuery(".aaSC_Control_BookTravel_RoundTrip, .aaSC_Control_BookTravel_OneWay").click(function(e){jQuery("#aa-fieldset-travelers").removeClass("aa-two-up");});jQuery(".aaSC_Control_BookTravel_RoundTripHotel:checked").each(function(){jQuery("#aa-fieldset-travelers").addClass("aa-two-up");});jQuery(".aaSC_Control_BookTravel_RoundTripHotel").click(function(e){jQuery("#aa-fieldset-travelers").addClass("aa-two-up");jQuery(".aaSC_Control_BookTravel_RedeemMiles:checked").each(function(){jQuery(this).removeAttr("checked").trigger("change");});jQuery(".aaSC_Control_BookTravel_AirPass:checked").each(function(){jQuery(this).removeAttr("checked").trigger("change");});});if($device.touch){jQuery("#aa-returningFrom").attr("readonly","readonly");jQuery("#aa-leavingOn").attr("readonly","readonly");}jQuery("#aa-leavingOn").datepicker({beforeShowDay:function(date){return[true,(((returningFromGetTime===date.getTime()))?"ui-state-highlight ui-state-active":"")];},beforeShow:function(input,inst){populateReturningFromGetTime();},onSelect:function(dateText,inst){try{checkLeavingOn();synchLeavingOnDropdowns();populateLeavingOnGetTime();}catch(ex){}}}).datepicker("setDate",aaBookingModuleFormatDate(jQuery("#reservationFlightSearchForm\\.flightParams\\.flightDateParams\\.travelMonth").val(),jQuery("#reservationFlightSearchForm\\.flightParams\\.flightDateParams\\.travelDay").val()));jQuery("#aa-returningFrom").datepicker({beforeShowDay:function(date){return[(leavingOnGetTime<=date.getTime()),((leavingOnGetTime===date.getTime())?"ui-state-highlight ui-state-active":"")];},beforeShow:function(input,inst){selected=0;if(inst.input.aaDateInput("getDate")===null){inst.input.datepicker("setDate",(jQuery("#aa-leavingOn").aaDateInput("getDate")));}populateLeavingOnGetTime();},onSelect:function(dateText,inst){try{checkReturningFrom();synchReturningFromDropdowns();populateReturningFromGetTime();selected=1;}catch(ex){}},onClose:function(input,inst){try{if(selected===0){inst.input.datepicker("setDate",new Date(year,month,1));}}catch(ex){}}}).datepicker("setDate",aaBookingModuleFormatDate(jQuery("#reservationFlightSearchForm\\.returnDate\\.travelMonth").val(),jQuery("#reservationFlightSearchForm\\.returnDate\\.travelDay").val()));jQuery("#aa-leavingOn, #aa-returningFrom").aaDateInput({userLocale:dynUserLocale});jQuery("#aa-leavingOn").blur(function(){checkLeavingOn();synchLeavingOnDropdowns();populateLeavingOnGetTime();});jQuery("#aa-returningFrom").blur(function(){checkReturningFrom();synchReturningFromDropdowns();populateReturningFromGetTime();});jQuery(".aaAutoComplete").aaAirportAutoComplete();});